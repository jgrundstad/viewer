{% extends "viewer/base.html" %}

{% block extra_js %}
<script type="text/javascript">
jQuery(document).ready(function(){
	$('select[name=study]').change(function(){
		var study_id = $(this).val();
		var options = [];
		request_url = '/viewer/get_samples/' + study_id + '/';
		$.getJSON(
			request_url,
			function(data){
				$.each(data, function(key, val) {
					options.push('<option value="' + key + '">' + val + '</option>');
				})
				$('select[name=sample]').html(options.join('\n'));
			}
		)
	})
});
</script>
{% endblock %}


{% block content %}
<div class="container" style="text-align: 'center'">
	<p>
	<h2>Create a new BionimbusID</h2>
	<form>
		<table>
			{{ study_selector_form.as_table }}
	</form>
	<form action="/viewer/new_bionimbus_id/" method="post" enctype="multipart/form-data">
		{% csrf_token %}
			{{ bnid_form.as_table }}
			{% if bnid_form.errors %}
    			{% for field in bnid_form %}
        			{% for error in field.errors %}
            			<div class="alert alert-error">
                			<strong>{{ error|escape }}</strong>
            			</div>
        			{% endfor %}
    			{% endfor %}
				{% for error in form.non_field_errors %}
        			<div class="alert alert-error">
            			<strong>{{ error|escape }}</strong>
        			</div>
    			{% endfor %}
			{% endif %}
		</table>
		<input type="submit" class="btn btn-primary" value="Create" />
	</form>
	<br>
</div>
<hr>
<div class="container" style="text-align: 'center'">
	<h3>Available Bnids:</h3>
	<table class="table table-hover">
		<thead>
			<tr>
				<th>Study</th>
				<th>Sample</th>
				<th>Sample Desc.</th>
				<th>BionimbusID</th>
				<th>BnID Desc.</th>
				<th>Creation Date</th>
			</tr>
		</thead>
		<tbody>
			{% for b in bnids %}
			<tr>
				<td>{{b.sample.study}}</td>
				<td>{{b.sample.name}}</td>
				<td>{{b.sample.description}}</td>
				<td><a href="/viewer/bnid_edit/{{ b.pk }}/" title="edit bnid" data-tooltip>{{b.bnid}}</a></td>
				<td>{{b.description}}</td>
				<td>{{b.creation_date}}</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
</div>
{% endblock %}
